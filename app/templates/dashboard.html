<!-- app/templates/dashboard.html -->
{% extends 'base.html' %}

{% block title %}Dashboard - MZUGOSS Welfare{% endblock %}
{% block page_title %}Dashboard{% endblock %}

{% block content %}
<div class="row">
    <!-- Quick Stats -->
    <div class="col-12 col-md-6 col-lg-3 mb-4">
        <div class="stat-card">
            <div class="stat-icon primary">
                <i class="fas fa-users"></i>
            </div>
            <div class="stat-info">
                <h3 id="totalMembers">--</h3>
                <p>Total Members</p>
            </div>
        </div>
    </div>
    <div class="col-12 col-md-6 col-lg-3 mb-4">
        <div class="stat-card">
            <div class="stat-icon success">
                <i class="fas fa-hand-holding-usd"></i>
            </div>
            <div class="stat-info">
                <h3 id="monthlyContributions">--</h3>
                <p>This Month</p>
            </div>
        </div>
    </div>
    <div class="col-12 col-md-6 col-lg-3 mb-4">
        <div class="stat-card">
            <div class="stat-icon warning">
                <i class="fas fa-user-clock"></i>
            </div>
            <div class="stat-info">
                <h3 id="pendingContributions">--</h3>
                <p>Pending</p>
            </div>
        </div>
    </div>
    <div class="col-12 col-md-6 col-lg-3 mb-4">
        <div class="stat-card">
            <div class="stat-icon info">
                <i class="fas fa-piggy-bank"></i>
            </div>
            <div class="stat-info">
                <h3 id="totalBalance">--</h3>
                <p>Total Balance</p>
            </div>
        </div>
    </div>
</div>

<div class="row">
    <!-- Report Generation Card -->
    <div class="col-12 col-lg-8 mb-4">
        <div class="card">
            <div class="card-header">
                <h3><i class="fas fa-file-chart-line"></i> Generate Contribution Report</h3>
            </div>
            <div class="card-body">
                <form action="{{ url_for('main.upload') }}" method="POST" enctype="multipart/form-data" id="uploadForm">
                    <!-- Data Source Toggle -->
                    <div class="form-section">
                        <label class="form-label">Data Source</label>
                        <div class="source-toggle">
                            <input type="radio" id="sourceFile" name="data_source" value="file" checked>
                            <label for="sourceFile" class="toggle-option">
                                <i class="fas fa-file-excel"></i>
                                <span>File Upload</span>
                            </label>
                            
                            <input type="radio" id="sourceSheets" name="data_source" value="sheets" {% if sheet_url %}checked{% endif %}>
                            <label for="sourceSheets" class="toggle-option">
                                <i class="fab fa-google"></i>
                                <span>Google Sheets</span>
                            </label>
                        </div>
                    </div>

                    <!-- File Upload Section -->
                    <div class="form-section" id="fileSection">
                        <label class="form-label">Upload Excel File</label>
                        <div class="file-upload-area" id="dropArea">
                            <i class="fas fa-cloud-upload-alt"></i>
                            <h4>Drag & Drop Your File</h4>
                            <p>Supported formats: .xlsx, .xls</p>
                            <input type="file" name="file" id="fileInput" accept=".xlsx,.xls" required>
                            <button type="button" class="btn btn-outline-primary" onclick="document.getElementById('fileInput').click()">
                                Browse Files
                            </button>
                            <div id="filePreview" class="file-preview"></div>
                        </div>
                    </div>

                    <!-- Google Sheets Section -->
                    <div class="form-section" id="sheetsSection" style="display: none;">
                        <div class="form-group">
                            <label for="sheet_url" class="form-label">Google Sheets URL</label>
                            <input type="url" class="form-control" id="sheet_url" name="sheet_url" 
                                   value="{{ sheet_url }}" placeholder="https://docs.google.com/spreadsheets/d/...">
                            <div class="form-text">
                                Make sure the sheet is shared with the service account
                            </div>
                        </div>
                    </div>

                    <!-- Period Selection -->
                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-group">
                                <label for="year" class="form-label">Year</label>
                                <select name="year" id="year" class="form-select" required>
                                    {% set current_year = datetime.now().year %}
                                    {% for y in range(2018, current_year + 2) %}
                                        <option value="{{ y }}" {% if y == current_year %}selected{% endif %}>{{ y }}</option>
                                    {% endfor %}
                                </select>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group">
                                <label for="month" class="form-label">Month</label>
                                <select name="month" id="month" class="form-select" required>
                                    {% set current_month = datetime.now().month %}
                                    {% for m in range(1, 13) %}
                                        <option value="{{ m }}" {% if m == current_month %}selected{% endif %}>
                                            {{ datetime(2023, m, 1).strftime('%B') }}
                                        </option>
                                    {% endfor %}
                                </select>
                            </div>
                        </div>
                    </div>

                    <button type="submit" class="btn btn-primary btn-lg w-100 mt-3" id="submitBtn">
                        <i class="fas fa-rocket"></i> Generate Report
                    </button>
                </form>
            </div>
        </div>
    </div>

    <!-- Quick Actions & Info -->
    <div class="col-12 col-lg-4 mb-4">
        <!-- Quick Actions -->
        <div class="card mb-4">
            <div class="card-header">
                <h3><i class="fas fa-bolt"></i> Quick Actions</h3>
            </div>
            <div class="card-body">
                <div class="quick-actions">
                    <a href="{{ url_for('main.contributors') }}" class="action-btn">
                        <i class="fas fa-users"></i>
                        <span>View Contributors</span>
                    </a>
                    <a href="{{ url_for('main.policies') }}" class="action-btn">
                        <i class="fas fa-file-contract"></i>
                        <span>Group Policies</span>
                    </a>
                    <a href="{{ url_for('main.settings') }}" class="action-btn">
                        <i class="fas fa-cog"></i>
                        <span>Settings</span>
                    </a>
                </div>
            </div>
        </div>

        <!-- System Info -->
        <div class="card">
            <div class="card-header">
                <h3><i class="fas fa-info-circle"></i> System Info</h3>
            </div>
            <div class="card-body">
                <div class="system-info">
                    
                    <div class="info-item">
                        <span class="info-label">Last Sync:</span>
                        <span class="info-value" id="lastSync">--</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">Active Members:</span>
                        <span class="info-value" id="activeMembers">--</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Recent Activity -->
<div class="row">
    <div class="col-12">
        <div class="card">
            <div class="card-header">
                <h3><i class="fas fa-history"></i> Recent Activity</h3>
            </div>
            <div class="card-body">
                <div class="activity-list" id="recentActivity">
                    <div class="activity-item">
                        <i class="fas fa-sync activity-icon"></i>
                        <div class="activity-content">
                            <p class="activity-text">System initialized and ready</p>
                            <small class="activity-time">{{ datetime.now().strftime('%Y-%m-%d %H:%M') }}</small>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="{{ url_for('static', filename='js/dashboard.js') }}"></script>
{% endblock %}